<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–æ–±–µ—Ä–∏ –ø–ª–µ–¥</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="quest-style.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #001f3f;
      color: white;
      overflow: hidden;
      position: relative;
    }

    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    h1, p {
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
    }

    #puzzle-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 20px auto;
      border: 4px solid white;
      background: #fff;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .puzzle-piece {
      position: absolute;
      width: 100px;
      height: 100px;
      background-size: 400px 400px;
      cursor: grab;
      transition: transform 0.2s;
      border: 1px solid #ccc;
    }

    .puzzle-piece.correct {
      cursor: default;
      z-index: 1;
      border: 2px solid #28a745; /* –ó–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞ */
    }

    .puzzle-piece.dragging {
      z-index: 10;
      transform: scale(1.1);
      cursor: grabbing;
    }

    #modal-box {
      display: none;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 40px;
      border-radius: 15px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70%;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
      z-index: 2;
    }

    #modal-box p {
      font-size: 2rem;
      font-weight: bold;
      color: #FFD700;
    }

    .next-button {
      margin-top: 20px;
      font-size: 1.2rem;
      background-color: #28a745;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }

    .next-button:hover {
      background-color: #218838;
    }

    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
  </style>
</head>
<body>
  <!-- –°–Ω–µ–≥ -->
  <div id="particles-js"></div>

  <div class="container text-center py-5">
    <h1 class="display-4">–°–æ–±–µ—Ä–∏ –ø–ª–µ–¥</h1>
    <p class="fs-5">–ü–µ—Ä–µ—Ç–∞—â–∏ –∫—É—Å–æ—á–∫–∏, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø–ª–µ–¥!</p>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–∞–∑–ª–∞ -->
    <div id="puzzle-container"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="modal-box">
      <p>–¢—ã —Å–æ–±—Ä–∞–ª–∞ –ø–ª–µ–¥! üéâ</p>
      <p>–û–±–µ—Ä–Ω–∏—Å—å, —Ç–∞–º –∂–¥—ë—Ç —Å—é—Ä–ø—Ä–∏–∑! üòä</p>
      <button class="next-button" onclick="nextLevel()">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫–≤–µ—Å—Ç—É</button>
    </div>
  </div>
  <!-- –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä -->
  <div id="music-player" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
    <button id="toggle-music" class="btn btn-primary">üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>
  </div>
  
  <script>
    const audio = new Audio("mp3/ereymusic ‚Äî Christmas Lofi Hip Hop (www.lightaudio.ru).mp3"); // –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –º—É–∑—ã–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É
    audio.loop = true;
  
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ localStorage
    if (localStorage.getItem("music-playing") === "true") {
      audio.play();
      document.getElementById("toggle-music").textContent = "‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É";
    }
  
    // –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏
    document.getElementById("toggle-music").addEventListener("click", () => {
      if (audio.paused) {
        audio.play();
        localStorage.setItem("music-playing", "true");
        document.getElementById("toggle-music").textContent = "‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É";
      } else {
        audio.pause();
        localStorage.setItem("music-playing", "false");
        document.getElementById("toggle-music").textContent = "üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É";
      }
    });
  
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
    window.addEventListener("beforeunload", () => {
      localStorage.setItem("music-time", audio.currentTime);
    });
  
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    const savedTime = localStorage.getItem("music-time");
    if (savedTime) {
      audio.currentTime = parseFloat(savedTime);
    }
  </script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ particles.min.js -->
    <script src="js/particles.min.js"></script>
    <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–Ω–µ–≥–∞ -->
    <script src="js/particles-config.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti"></script>
  <script>
    const puzzleContainer = document.getElementById("puzzle-container");
    const modalBox = document.getElementById("modal-box");

    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫—É—Å–æ—á–∫–æ–≤ –∏ –∏—Ö –ø–æ–∑–∏—Ü–∏–∏
    const puzzlePieces = [
      { x: 0, y: 0, bgPos: "0px 0px" },
      { x: 100, y: 0, bgPos: "-100px 0px" },
      { x: 200, y: 0, bgPos: "-200px 0px" },
      { x: 300, y: 0, bgPos: "-300px 0px" },
      { x: 0, y: 100, bgPos: "0px -100px" },
      { x: 100, y: 100, bgPos: "-100px -100px" },
      { x: 200, y: 100, bgPos: "-200px -100px" },
      { x: 300, y: 100, bgPos: "-300px -100px" },
      { x: 0, y: 200, bgPos: "0px -200px" },
      { x: 100, y: 200, bgPos: "-100px -200px" },
      { x: 200, y: 200, bgPos: "-200px -200px" },
      { x: 300, y: 200, bgPos: "-300px -200px" },
      { x: 0, y: 300, bgPos: "0px -300px" },
      { x: 100, y: 300, bgPos: "-100px -300px" },
      { x: 200, y: 300, bgPos: "-200px -300px" },
      { x: 300, y: 300, bgPos: "-300px -300px" }
    ];

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫—É—Å–æ—á–∫–∏
    const shuffledPieces = [...puzzlePieces].sort(() => Math.random() - 0.5);

    shuffledPieces.forEach(piece => {
      const div = document.createElement("div");
      div.classList.add("puzzle-piece");
      div.style.left = `${Math.random() * 300}px`;
      div.style.top = `${Math.random() * 300}px`;
      div.style.backgroundImage = "url('images/blanket.jpg')";
      div.style.backgroundPosition = piece.bgPos;
      div.dataset.correctX = piece.x;
      div.dataset.correctY = piece.y;

      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      div.addEventListener("mousedown", (e) => startDrag(e, div));
      puzzleContainer.appendChild(div);
    });

    function startDrag(e, piece) {
      const offsetX = e.clientX - piece.offsetLeft;
      const offsetY = e.clientY - piece.offsetTop;

      piece.classList.add("dragging");

      function movePiece(event) {
        piece.style.left = `${event.clientX - offsetX}px`;
        piece.style.top = `${event.clientY - offsetY}px`;
      }

      function dropPiece() {
        piece.classList.remove("dragging");

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
        const x = parseInt(piece.style.left);
        const y = parseInt(piece.style.top);
        const correctX = parseInt(piece.dataset.correctX);
        const correctY = parseInt(piece.dataset.correctY);

        if (Math.abs(x - correctX) < 20 && Math.abs(y - correctY) < 20) {
          piece.style.left = `${correctX}px`;
          piece.style.top = `${correctY}px`;
          piece.classList.add("correct");
        }

        document.removeEventListener("mousemove", movePiece);
        document.removeEventListener("mouseup", dropPiece);

        checkCompletion();
      }

      document.addEventListener("mousemove", movePiece);
      document.addEventListener("mouseup", dropPiece);
    }

    function checkCompletion() {
      const pieces = document.querySelectorAll(".puzzle-piece");
      const isCompleted = Array.from(pieces).every(piece =>
        piece.classList.contains("correct")
      );

      if (isCompleted) {
        triggerConfetti();
        showModal();
      }
    }

    function triggerConfetti() {
      confetti({
        particleCount: 200,
        spread: 100,
        origin: { y: 0.6 },
      });
    }

    function showModal() {
      modalBox.style.display = "block";
    }

    function nextLevel() {
      window.location.href = "question2.html";
    }
  </script>
</body>
</html>
